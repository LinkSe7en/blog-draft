# 稀疏与绵密，HBase动态列or固定列？

用户画像技术实现长篇连载

## 0 写在前面

### 0.1 长篇连载第一坑

上次写了个职场文，虽说被多位大佬翻牌子，相当exciting。但自己还是比较喜欢总结下技术。~~有机会再瞎扯一下职场心得~~

以前的技术总结，都是在群里讨论的过程中，在大概细节都描述完了，总体来个概括，或者直接PPT截图胡脸。其中丢失了不少细节，总体也不够结构化。

所以感觉要开个长篇连载，来描述讨论过的技术问题。

这里就拿经常被讨论的用户画像，来开我写技术总结的新天坑~

### 0.2 用户画像

在上家给电信运营商开发过用户画像项目。虽说和互联网大厂实际应用的用户画像，形式上有所出入，但是核心理念还是能互通的。这里只讨论该项目中的场景：标签数据是离线开发成宽表的。应用场景只有2个，面向详单查询的数据应用，和面向OLAP的宽表分析

话不多说，言归正传：

## 1 比技术专家的头发还稀疏的宽表

![](../resources/sparse-hair.jpg)

###### #你感受到力量了吗（图文无关）

画像标签数据为啥会稀疏呢？首先我们得看标签数据是什么，怎么来的。

**画像标签本质就是基于用户的业务行为，总结出的一系列结论性数据。**

因此性别，年龄这种，不属于画像标签，应该叫用户属性。

那么问题来了。每个用户，其产生的业务行为，并不会覆盖所有的业务模块。而我们的标签数据，又是由各业务模块产生的业务数据，从ODS一路生产下来。

用户行为没覆盖到的业务模块，对应标签没有就是没有了咯……

真的没有了吗？

### 1.1 数据质量的锅

ETL、清洗口径

### 1.2 数据治理的锅

丢数据？至少一次和精确一次语义？

### 1.3 没锅可甩了

好吧它就是这么稀疏，你能怎么办？

## 2 面向应用

### 2.1 Why HBase

### 2.2 How HBase

### 2.3 HBase存储简述

### 2.4 表结构设计

HBase应用的重中之重，就是行键设计

#### 2.4.1 有序行键

自增ID喜欢吗，对不起，不许胡闹。

#### 2.4.2 隐式有序（半有序）行键

又想自增，又想离散，~~你喜欢就好~~业务需求为重啊。

在用户画像里，时序是我们的好盆友

#### 2.4.3 离散行键

好是好，但是彻底把锅甩给外部二级索引，excuse me？

### 2.5 列族划分

疯狂的store装载，卸载。HBase表示感谢你全家。

列族应视为关系型数据库的拓展表。列族划分要充分考虑全局业务逻辑。

### 2.6 分工合作

关系型和非关系型数据库，不是欢喜冤家，而是互相补充。

## 3 后面再说吧

技术总结要是和又臭又长的简历一样hard to read，你们就弃番了。另外卖卖关子，你们才不那么容易抛弃我 T^T

